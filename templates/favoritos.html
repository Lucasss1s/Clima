<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Favoritos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='favoritos.css') }}">
    <script>
        function toggleClima(event, ciudad) {
            const cityCard = event.target.closest('.ciudad-card'); 
            const climaDiv = cityCard.querySelector('.clima'); 
            if (!climaDiv.classList.contains('visible')) {
                fetch(`/clima_ciudad?ciudad=${ciudad}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            climaDiv.innerHTML = `<p>Error: ${data.error}</p>`;
                        } else {
                            climaDiv.innerHTML = `
                                <p><strong>Clima actual:</strong> ${data.temp}°C, ${data.descripcion}</p>
                            `;
                        }
                        climaDiv.classList.add('visible');
                    });
            } else {
                climaDiv.classList.remove('visible');
            }
        }
    </script>
</head>
<body>
    <nav>
        <div class="titulo">ClimaDaVinci</div>
        <div class="menu-links">
            <a href="/">Inicio</a>
            <a href="/radar">Radar de lluvia</a>
            {% if 'usuario_id' in session %}
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleMenu()">{{ session['nombre_usuario'] }}</button>
                    <div id="dropdown-content" class="dropdown-content">
                        <a href="/favoritos">Favoritos</a>
                        <a href="{{ url_for('logout') }}">Cerrar sesión</a>
                    </div>
                </div>
            {% else %}
                <a href="/login">Iniciar Sesión</a>
            {% endif %}
        </div>
    </nav>

    <h2 class="favorito">Mis Favoritos</h2>
    
    {% if favoritos_lista and favoritos_lista|length > 0 %}
        <ul>
            {% for favorito in favoritos_lista %}
                <li class="ciudad-card">
                    <div class="ciudad-eliminar">
                        <span>{{ favorito }}</span>
                        <form method="post" action="{{ url_for('favoritos') }}">
                            <input type="hidden" name="ciudad" value="{{ favorito }}">
                            <button type="submit">Eliminar</button>
                        </form>
                    </div>
                    <button class="flecha" onclick="toggleClima(event, '{{ favorito }}')">&#8594;</button>
                    <div class="clima"></div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No tienes favoritos guardados.</p>
    {% endif %}

    <form method="post" action="{{ url_for('borrar_historial') }}">
        <button type="submit">Borrar Historial</button>
    </form>

</body>
</html>
